USE [DB1]
GO
/****** Object:  Trigger [dbo].[T_Autor_Ksiazki]    Script Date: 2014-07-14 08:20:13 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO




ALTER TRIGGER [dbo].[T_Autor_Ksiazki]
   ON  [dbo].[Autor] 
   AFTER INSERT
AS 
BEGIN

	
	SET NOCOUNT ON;
	Declare @Identyfikator_A int
	Set @Identyfikator_A = (Select Max(dbo.Autor.Id_A) From dbo.Autor)
	--Declare @Imie varchar(30)
	--Set @Imie = (Select Imie From dbo.Autor Where Id_A = (Select Max(dbo.Autor.Id_A) From dbo.Autor))
	--Declare @Nazwisko varchar(30)
	--Set @Nazwisko = (Select Nazwisko From dbo.Autor Where Id_A = (Select Max(dbo.Autor.Id_A) From dbo.Autor))
	Declare @Nazwa_widoku varchar(200)
	Set @Nazwa_widoku = 'Autor_Ksiazki_' + (Select Cast(@Identyfikator_A As varchar(20)))
	--Set @Nazwa_widoku = @Imie + '_' + @Nazwisko
	Declare @SQL varchar(max)
	Set @SQL = 'Create View ' + @Nazwa_widoku + ' As Select Lp, Tytul, Opis, Rok_w
	From dbo.F_AutorKsiazki('+ (Select Cast(@Identyfikator_A As varchar(20)))+')'
	Execute (@SQL)
	

END
